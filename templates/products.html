<%inherit file="/base.html"/>

<%block name="on_doc_ready">
    function vote(element, direction, type) {
        var product_id = element.attr("product_id");
        var category_url = element.attr("category_url");
        $.post("/browse/" + category_url + "/" + product_id, {direction:direction, vote_type:type}, function(data) {
            $("#votes_" + product_id).html(data.vote_count);
            $(".up_" + product_id).removeClass("upmod up");
            $(".down_" + product_id).removeClass("downmod down");
            if(data.vote_status == "up") {
                $(".up_" + product_id).addClass("upmod");
                $(".down_" + product_id).addClass("down");
            } else if(data.vote_status == "down") {
                $(".down_" + product_id).addClass("downmod");
                $(".up_" + product_id).addClass("up");
            } else {
                $(".up_" + product_id).addClass("up");
                $(".down_" + product_id).addClass("down");
            }
        }, "json");
    }

    $(".arrow").click(function() {
        element = $(this);
        if(element.hasClass("up")) {
            vote($(this), "up", "add");
        } else if(element.hasClass("down")) {
            vote($(this), "down", "add");
        } else if(element.hasClass("downmod")) {
            vote($(this), "down", "remove");
        } else if(element.hasClass("upmod")) {
            vote($(this), "up", "remove");
        }
    });
</%block>

<ul class="product_list">
    % for product_info, vote_class, vote_count in products:
    <%
    if vote_class == "up":
        upclass = "upmod"
        downclass = "down"
    elif vote_class == "down":
        upclass = "up"
        downclass = "downmod"
    else:
        upclass = "up"
        downclass = "down"
    %>
    <li>
        <table>
            <tr>
                <td class="arrow up_${product_info.id} ${upclass}" product_id="${product_info.id}" category_url="${product_info.internal_url}" />
                <td><a href="${product_info.url}">${product_info.name}</a></td>
            </tr>
            <tr>
                <td class="arrow down_${product_info.id} ${downclass}" product_id="${product_info.id}" category_url="${product_info.internal_url}" />
                <td><span id="votes_${product_info.id}">${vote_count}</span> points | ${product_info.price}</td>
            </tr>
        </table>
    </li>
    % endfor
</ul>
